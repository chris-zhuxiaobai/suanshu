# 功能对照表：菜单树 vs 业务需求

本文档对照当前菜单树结构与业务需求，明确各功能的开发状态与待办事项。

---

## 一、数据概览

| 菜单项 | 路径 | 状态 | 功能说明 | 备注 |
|--------|------|------|----------|------|
| 首页 | `/overview/home` | ✅ 已完成 | 欢迎页、用户信息展示、退出登录 | 已实现 |

---

## 二、车队管理

| 菜单项 | 路径 | 状态 | 功能说明 | 业务需求对应 | 待办事项 |
|--------|------|------|----------|--------------|----------|
| **车辆排班设置** | `/fleet/schedule` | ❌ 待开发 | 配置每天哪些车辆轮休/营运 | **1.2 车辆排班（轮休）** | 1. 日历视图（可选）<br>2. 日期范围选择（当天起往后最多1个月）<br>3. 批量设置轮休/营运<br>4. 当天即时配置<br>5. 登录提醒：当天未报账车辆 |
| **服务员跟车配置** | `/fleet/staff-config` | ❌ 待开发 | 配置每月售票员排班（哪辆车配哪个售票员） | **1.1 车队与车辆**<br>**1.6 售票员排班** | 1. 按月排班配置（每月1号前配置）<br>2. 历史排班查询<br>3. 排班记录：车辆ID + 售票员ID（车号）<br>4. 校验：本车售票员不跟本车（可选校验） |
| **车辆管理** | `/fleet/vehicles` | ✅ 已完成 | 车辆CRUD、排序、状态管理 | **1.1 车队与车辆** | 已实现：列表、新增、编辑、删除、搜索、状态筛选 |

---

## 三、数据统计

| 菜单项 | 路径 | 状态 | 功能说明 | 业务需求对应 | 待办事项 |
|--------|------|------|----------|--------------|----------|
| **统计页面** | `/stats/report` | ❌ 待开发 | 按日/月汇总、分配计算、导出 | **1.3 收入构成与入账**<br>**1.4 分配与结账**<br>**1.5 月表与精度修正** | 1. 日汇总：各车收入、平均收入、收付金额<br>2. 月汇总：月总收入、扣除服务费、平均分配、每车收付<br>3. 手动修正结算金额（月表）<br>4. 数据导出（Excel/PDF）<br>5. 转数统计（不含第5转） |

---

## 四、缺失功能（需新增菜单或集成）

| 功能 | 状态 | 功能说明 | 业务需求对应 | 建议位置 | 待办事项 |
|------|------|----------|--------------|----------|----------|
| **收入录入** | ✅ 已完成 | 每天录入各车收入情况 | **1.3 收入构成与入账** | **收入录入**菜单（`/income/entry`） | ✅ 已实现：<br>1. 日期选择（默认今天，不能选择未来日期，支持"今天"按钮）<br>2. 车辆列表（显示所有车辆，支持搜索和状态筛选）<br>3. 表单：5转收入、微信收入、补油款、奖罚<br>4. 自动计算：营业额、净收入、转数<br>5. 金额精度：一位小数、截断<br>6. 转数收入显示：null或0.0显示为空<br>7. 操作员记录：创建和更新时都记录操作员<br>8. 修改限制：只能修改当月的记录<br>9. 删除限制：不允许删除，只能修改<br>10. 单条录入（每个车辆单独保存）<br>11. **统计Tab页**：显示当日统计数据和每辆车正负值 ✅ |
| **管理员服务费配置** | ❌ 待开发 | 配置每月管理员服务费（工资） | **1.4 分配与结账** | 建议：**数据统计**下新增「服务费配置」或系统设置 | 1. 按月配置服务费<br>2. 历史记录查询<br>3. 用于月汇总计算 |
| **数据导出**（daochu专用） | ❌ 待开发 | 按月份展示 + 一键导出 | **业务需求** | 建议：**数据统计**下新增「数据导出」或独立菜单 | 1. 月份选择<br>2. 数据展示（月汇总、日明细）<br>3. 一键导出（Excel/PDF）<br>4. **权限控制**：仅 daochu 账户可访问 |

---

## 五、功能开发优先级建议

### 第一阶段（核心功能）
1. ✅ **车辆管理** - 已完成
2. ❌ **收入录入** - 核心业务，每天必用
3. ❌ **服务员跟车配置** - 每月必配，影响收入录入时的售票员选择

### 第二阶段（排班与提醒）
4. ❌ **车辆排班设置** - 用于提醒未报账车辆
5. ❌ **管理员服务费配置** - 用于月汇总计算

### 第三阶段（统计与导出）
6. ❌ **统计页面** - 日/月汇总、分配计算
7. ❌ **数据导出**（daochu专用） - 导出功能

---

## 六、菜单结构调整建议

### 方案A：保持当前结构，补充缺失功能

```
数据概览
  ├─ 首页 ✅
  └─ 收入录入 ❌ (新增)

车队管理
  ├─ 车辆排班设置 ❌
  ├─ 服务员跟车配置 ❌
  └─ 车辆管理 ✅

数据统计
  ├─ 统计页面 ❌
  ├─ 服务费配置 ❌ (新增)
  └─ 数据导出 ❌ (新增，daochu专用)
```

### 方案B：按业务流程重组（推荐）

```
数据概览
  ├─ 首页 ✅
  └─ 收入录入 ❌ (新增)

车队管理
  ├─ 车辆管理 ✅
  ├─ 车辆排班设置 ❌
  └─ 服务员跟车配置 ❌

数据统计
  ├─ 日汇总 ❌ (统计页面拆分)
  ├─ 月汇总 ❌ (统计页面拆分)
  ├─ 服务费配置 ❌ (新增)
  └─ 数据导出 ❌ (新增，daochu专用)
```

---

## 七、数据表设计待办

| 表名 | 状态 | 说明 | 待办事项 |
|------|------|------|----------|
| `vehicles` | ✅ 已完成 | 车辆表 | - |
| `vehicle_schedules` | ❌ 待设计 | 车辆排班（轮休）表 | 字段：date, vehicle_id, status (rest/operate) |
| `conductor_schedules` | ❌ 待设计 | 售票员排班表 | 字段：year, month, vehicle_id, conductor_id (车号) |
| `daily_incomes` | ✅ 已完成 | 每日收入记录表 | ✅ 已实现：date, vehicle_id, conductor_id, turn1-5收入, wechat收入, fuel_subsidy, reward_penalty, revenue(营业额), net_income(净收入), turn_count, is_overtime(是否加班), operator_name(操作员), remark, created_at, updated_at |
| `daily_statistics` | ✅ 已完成 | 每日统计表 | ✅ 已实现：date, total_revenue(总营业额), total_net_income(总净收入), vehicle_count(车辆数量), average_revenue(平均营业额), average_net_income(平均净收入), created_at, updated_at |
| `admin_salaries` | ❌ 待设计 | 管理员服务费表 | 字段：year, month, amount |
| `monthly_settlements` | ❌ 待设计 | 月汇总表 | 字段：year, month, 自动结算金额, 手动修正金额, 每车收付明细 |

---

## 八、权限控制

| 功能 | admin | daily_admin | daochu | viewer |
|------|-------|-------------|--------|--------|
| 车辆管理 | ✅ | ✅ | ❌ | ❌ |
| 车辆排班设置 | ✅ | ✅ | ❌ | ❌ |
| 服务员跟车配置 | ✅ | ✅ | ❌ | ❌ |
| 收入录入 | ✅ | ✅ | ❌ | ❌ |
| 统计页面 | ✅ | ✅ | ❌ | ❌ |
| 服务费配置 | ✅ | ✅ | ❌ | ❌ |
| **数据导出** | ❌ | ❌ | ✅ | ❌ |

---

## 九、变更记录

| 日期       | 说明           |
|------------|----------------|
| 2025-02-10 | 初建功能对照表 |
| 2025-02-10 | 车辆管理功能完成标记 |
| 2026-02-11 | 收入录入功能完成，新增统计Tab页和每日统计表 |
