version: '3.8'

services:
  # 本地专用：Node 容器，开启热更新
  # 注意：不暴露端口到宿主机，统一通过 Nginx (80端口) 访问，与生产环境保持一致
  frontend:
    image: node:24-alpine
    container_name: suanshu-frontend
    volumes:
      # 仅挂载源码目录，node_modules 会在此目录下由容器 npm install 生成，宿主机与 IDE 可直接使用
      - ./frontend:/app
    working_dir: /app
    # Umi Max 已在 config 中固定 host=0.0.0.0 / port=8000，这里无需再透传参数
    command: sh -c "npm install && npm run dev"
    # 继承根目录 .env，让前端也能感知 APP_NAME 等配置（直接使用 APP_NAME）
    env_file:
      - .env
    networks:
      - suanshu-net
    restart: unless-stopped

  web:
    volumes:
      - ./.docker/nginx/dev.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - frontend