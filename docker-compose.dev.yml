services:
  # 本地专用：Node 容器，开启热更新
  # 注意：不暴露端口到宿主机，统一通过 Nginx (80端口) 访问，与生产环境保持一致
  frontend:
    image: node:24-alpine
    container_name: suanshu-frontend
    volumes:
      # 仅挂载源码目录，node_modules 会在此目录下由容器 npm install 生成，宿主机与 IDE 可直接使用
      - ./frontend:/app
    working_dir: /app
    # Umi Max 已在 config 中固定 host=0.0.0.0 / port=8000，这里无需再透传参数
    # 先 install 再 dev；失败时不再重启，便于 docker logs 查看原因
    # 不加载根目录 .env，避免其中变量被 npm 误读导致 "Invalid Version"（仅传入前端需要的）
    command: sh -c "npm install && npm run dev"
    environment:
      - APP_NAME=${APP_NAME:-黄桥车队账目管理系统}
    networks:
      - suanshu-net
    # 开发环境不自动重启，避免崩溃后无限重启无法查看日志
    restart: "no"

  web:
    volumes:
      - ./.docker/nginx/dev.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - frontend